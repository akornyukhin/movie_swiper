- name: Prune all images
  docker_prune:
    containers: yes
    images: yes
    images_filters:
      dangling: false

- name: Login to Docker Hub registry
  docker_login:
    username: '{{ docker_hub_user_var }}'
    password: '{{ docker_hub_pass_var }}'

- name: Copy docker-compose file for app containers
  template:
    src: '{{ docker_compose_template_path }}'
    dest: '{{ docker_compose_file }}'
    owner: '{{ ansible_user }}'
    group: '{{ ansible_user }}'
    force: yes

- name: Bring app up with docker-compose file
  docker_compose:
    project_src: '{{ app_directory }}'
  register: output

- name: docker-compose up output
  debug:
    var: output